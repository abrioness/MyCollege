@model WebColegio.Models.ViewModel.ColeccionCatalogos
 @{
	ViewData["Title"] = "Estado De Cuenta Cajera";
} 


<div class="container-fluid p-1" style="margin:2px;">
	<div class="card shadow-lg p-3 mb-5 bg-white rounded">
		<div class="card-header bg-primary text-white">
			<h5 class="mb-0"><i class="bi bi-graph-up-arrow"></i>  Estado Cuenta del Estudiante</h5>
		</div>

		<div class="card-body">
			<div class="table-responsive" style="font-size: 12px;">
			<div class="col-12 text-end">

				<a asp-action="Create" class="btn btn-primary">
					<i class="bi bi-plus-circle"></i> Agregar Pago
				</a>
			</div><br />
			
					<table id="estadocuenta" class="table table-bordered table-sm">
					@* class="display responsive nowrap" style="width:100%"> *@
					<thead>
						<tr>
							<th>Alumno</th>
							<th>Grado</th>
							<th>Matrícula</th>
							<th>Enero</th>
							<th>Febrero</th>
							<th>Marzo</th>
							<th>Abril</th>
							<th>Mayo</th>
							<th>Junio</th>
							<th>Julio</th>
							<th>Agosto</th>
							<th>Septiembre</th>
							<th>Octubre</th>
							<th>Noviembre</th>
							<th>Diciembre</th>

						</tr>
					</thead>
					<tbody>
						@foreach (var pagos in Model.pagos)
						{
							<tr>
								@{
									var alumno = Model.alumno.FirstOrDefault(al => al.IdAlumno == pagos.IdAlumno);
								}
								<td>
									<span class="btn btn-sm btn-info">
										@alumno.Nombre @alumno.Apellido
									</span>
								</td>

								@* Buscar grado y periodo asociados si aplica *@
								@{
									var grado = Model.grados.FirstOrDefault(g => g.IdGrado == alumno.IdGrado);
									
								}

								<td>@(grado?.NombreGrado ?? "-")</td>
								@{

									var periodo = Model.periodo.FirstOrDefault(p => p.IdPeriodo == pagos.IdPeriodo);

								}
								<td>@(periodo?.Periodo.ToString() ?? "-")</td>

								@* Mostrar columnas de los 12 meses *@
								@* @for (int mes = 1; mes <= 12; mes++)
								{
									var pagoMes = Model.pagos
									.FirstOrDefault(p => p.IdAlumno == alumno.IdAlumno && p.IdMes == mes);

									if (pagoMes != null)
									{
										<td>✔️</td>
									}
									else
									{
										<td>❌</td>
									}
								} *@
								@* Mostrar columnas de los 12 meses *@
								@for (int mes = 1; mes <= 12; mes++)
								{
									var pagoMes = Model.pagos
									.FirstOrDefault(p => p.IdAlumno == alumno.IdAlumno && p.IdMes == mes);
									@if (pagoMes != null)
									{
										<td>
											<span class="badge bg-success">Pagado</span>
										</td>
									}
									
									else
									{
										<td><span class="badge bg-warning text-dark">Pendiente</span>
										</td>
									}
									
								}
							</tr>
						}
					</tbody>

				</table>
			</div>
		</div>
		</div>
	</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<script>
	$(document).ready(function () {
			$('#estadocuenta').DataTable({
			responsive: false,
			dom: 'Bfrtip', // Botones + filtro + tabla
			buttons: [
				{
					extend: 'excelHtml5',
					text: 'Exportar a Excel',
					className: 'btn btn-success'
				}
			],
			language: {
				url: "//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
			}
		});
	});
</script>