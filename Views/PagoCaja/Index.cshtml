@model WebColegio.Models.ViewModel.ColeccionCatalogos
@* @{
	ViewData["Title"] = "Index";
} *@
<script src="~/js/site.js"></script>
@* <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" /> *@
<div class="container mt-auto" style="padding:2px;">
	<div class="card shadow-lg p-3 mb-5 bg-white rounded">
		<div class="card-header bg-primary text-white">
			<h5 class="mb-0"><i class="bi bi-cash-coin"></i> Reporte de Caja Varios</h5>
		</div>

		<div class="card-body">
			<div class="table-responsive" style="font-size:12px">
				<div class="col-4 text-center">
					@using (Html.BeginForm("Index", "PagoCaja", FormMethod.Get))
					{
						<div class="row">
							<div class="col-4">
								<label class="control-label">Desde:</label>
								<input type="date" name="fechainicio" id="FechaInicio" class="form-control"
									   value="@@(Request.QueryString[" fechainicio"])" />
							</div>
							<div class="col-4">
								<label class="control-label">Hasta:</label>
								<input type="date" name="fechafin" id="FechaFin" class="form-control"
									   value="@@(Request.QueryString[" fechafin"])" />
							</div>
							<div class="col-4">
								<br />
								<button type="submit" class="form-control btn btn-success">Filtrar</button>
							</div>
						</div>
					}
				</div>
				@* <div class="col-6 text-start">
				<div class="form-group">
					<label class="control-label">Fecha de Inicio</label>
					<input type="date" asp-for=".FechaEmision" id="FechaEmision" pattern="\d{2}/\d{2}/\d{4}" placeholder="dd/mm/yyyy" class="form-control" />
					<span asp-validation-for=".FechaEmision" class="text-danger"></span>
				</div>
				<div class="form-group">
					<label asp-for="PagosCaja.FechaEmision" class="control-label">Fecha Fin</label>
					<input type="date" asp-for="PagosCaja.FechaEmision" id="FechaEmision" pattern="\d{2}/\d{2}/\d{4}" placeholder="dd/mm/yyyy" class="form-control" />
					<span asp-validation-for="PagosCaja.FechaEmision" class="text-danger"></span>
				</div>
				<div class="form-group">
					<a asp-action="FiltrarPorFecha" class="btn btn-primary">
						<i class="bi bi-search"></i> Filtrar
					</a>
				</div>
			</div> *@
				<div class="col-12 text-end">

					<a asp-action="Create" class="btn btn-primary">
						<i class="bi bi-plus-circle"></i> Agregar Pago de Caja
					</a>
				</div>

				<table id="tablaPagos" class="table table-bordered table-sm">
					@* class="display responsive nowrap" style="width:100%"> *@
					<thead>
						<tr>
							<th>Número Recibo</th>
							<th>Nombre</th>
							<th>Concepto</th>
							<th>Estado Pagos Rifas</th>
							<th>Monto</th>
							<th>Nivel</th>
							<th>Turno</th>
							<th>Descripción</th>
							<th>Colegio</th>
							<th>Fecha Emisión</th>

						</tr>
					</thead>
					<tbody>
						@foreach (var itemPagoCaja in Model.pagoCajas)
						{
							<tr>


								<td>

									<a asp-action="Details" asp-controller="PagoCaja" asp-route-id="@itemPagoCaja.IdPagoCaja" class="btn btn-sm btn-info">@itemPagoCaja.NumeroRecibo</a>

								</td>


								@* @foreach (var tipoMovimiento in Model.tipoMovimiento.Where(a => a.IdTipoMovimiento == itemPago.IdTipoMovimiento))
							{
								<td>

									@tipoMovimiento.Concepto

								</td>
							} *@
								<td>


									@(string.IsNullOrWhiteSpace(itemPagoCaja.Nombre)
																										? " "
																										: itemPagoCaja.Nombre)
								</td>

								@foreach (var tipoMovimiento in Model.tipoMovimiento.Where(a => a.IdTipoMovimiento == itemPagoCaja.Concepto))
								{
									<td>


										@(string.IsNullOrWhiteSpace(tipoMovimiento.Concepto)
																											? " "
																											: tipoMovimiento.Concepto)
									</td>
								}
								<td>
									C$	@(string.IsNullOrWhiteSpace(itemPagoCaja.Monto.ToString())
																							? " "
																							: itemPagoCaja.Monto.ToString())

								</td>

								@{
									var nivel = Model.grados.
									FirstOrDefault(a => a.IdGrado == itemPagoCaja.IdGrado);
									}
								<td>
										@(string.IsNullOrEmpty(nivel.NombreGrado)
																	? "Sin Datos"
																	: nivel.NombreGrado)
									

								</td>
							
								@{
								var turno=Model.turnos.
								FirstOrDefault(a => a.IdTurno == itemPagoCaja.IdTurno);
								}
								<td>
										@(string.IsNullOrWhiteSpace(turno.NombreTurno)
																	? " "
																	: turno.NombreTurno)
									

								</td>
							
							<td>

									@(string.IsNullOrWhiteSpace(itemPagoCaja.Descripcion)
																? " "
																: itemPagoCaja.Descripcion)
							</td>
								@{
									var recinto = Model.recintos
									.FirstOrDefault(a => a.IdRecinto == itemPagoCaja.IdRecinto);
								}
									<td>

										@(string.IsNullOrWhiteSpace(recinto?.Recinto) ? "Sin Recinto" : recinto.Recinto)

									</td>
								
							<td>
									@(string.IsNullOrWhiteSpace(itemPagoCaja.FechaRegistro.ToString("dd/MM/yyyy"))
																? " "
																: itemPagoCaja.FechaRegistro.ToString("dd/MM/yyyy"))
                                
							</td>

							@* <td>
							<a asp-action="Edit" asp-controller="Notas" asp-route-id="@itemNotas.IdNota" class="btn btn-sm btn-success"><i class="bi bi-pencil-square"></i></a>
						</td> 
							<td>
								<a asp-action="Details" asp-controller="Notas" asp-route-id="@itemNotas.IdNota" class="btn btn-sm btn-warning"><i class="bi bi-journal-richtext"></i></a>
							</td>*@
						</tr>
					}
				</tbody>

			</table>
		</div>
		</div>
	</div>
</div>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<script>
	$(document).ready(function () {
			$('#tablaPagos').DataTable({
			responsive: false,
			dom: 'Bfrtip', // Botones + filtro + tabla
			buttons: [
				{
					extend: 'excelHtml5',
					text: 'Exportar a Excel',
					className: 'btn btn-success'
				}
			],
			language: {
				url: "//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
			}
		});
	});
</script>